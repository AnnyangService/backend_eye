---
description: 
globs: 
alwaysApply: false
---
---
description: Use this structure guide every time you add new files or directories
globs: 
alwaysApply: false
---
# í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡° ê°€ì´ë“œ (ë„ë©”ì¸ ê¸°ë°˜ + ì „ì—­/ê³µí†µ ëª¨ë“ˆ ë¶„ë¦¬)
> ğŸ“Œ Cursorì—ì„œ íŒŒì¼ ìƒì„± ì‹œ ì´ êµ¬ì¡°ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

---

## 1. ì „ì²´ êµ¬ì¡° ìš”ì•½
```
backend_eye/
â”œâ”€â”€ app/ # ì• í”Œë¦¬ì¼€ì´ì…˜ íŒ¨í‚¤ì§€
â”‚ â”œâ”€â”€ init.py # Flask ì•± ì´ˆê¸°í™”
â”‚ â”œâ”€â”€ config.py # ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
â”‚ â”œâ”€â”€ global/ # ì „ì—­ ì„¤ì •, ê³µí†µ ì˜ˆì™¸/ì‘ë‹µ ë“±
â”‚ â”œâ”€â”€ auth/ # ì¸ì¦/ì¸ê°€ (JWT, OAuth2 ë“±)
â”‚ â”œâ”€â”€ user/ # ì‚¬ìš©ì ë„ë©”ì¸
â”‚ â”œâ”€â”€ cat_eye/ # ê³ ì–‘ì´ ëˆˆ ì§„ë‹¨ ë„ë©”ì¸
â”‚ â””â”€â”€ models/ # AI ëª¨ë¸ ê´€ë ¨ íŒŒì¼
â”œâ”€â”€ requirements.txt # ì˜ì¡´ì„± íŒ¨í‚¤ì§€
â”œâ”€â”€ .env # í™˜ê²½ ë³€ìˆ˜ (gitignored)
â””â”€â”€ run.py # ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì 
```

---

## 2. global/ - ì „ì—­ ì„¤ì • ë° ê³µí†µ ìœ í‹¸
global/
â”œâ”€â”€ init.py
â”œâ”€â”€ config/ # ì „ì—­ ì„¤ì •
â”‚ â””â”€â”€ init.py
â”œâ”€â”€ exception/ # ê³µí†µ ì˜ˆì™¸ ì²˜ë¦¬ ë° ì˜ˆì™¸ ìƒìœ„ í´ë˜ìŠ¤
â”‚ â”œâ”€â”€ init.py
â”‚ â”œâ”€â”€ business_exception.py
â”‚ â””â”€â”€ exception_handler.py
â”œâ”€â”€ response/ # ê³µí†µ ì‘ë‹µ í¬ë§· ë° ì—ëŸ¬ ì½”ë“œ
â”‚ â”œâ”€â”€ init.py
â”‚ â”œâ”€â”€ api_response.py
â”‚ â”œâ”€â”€ error_response.py
â”‚ â””â”€â”€ error_code.py
â””â”€â”€ util/ # ê³µí†µ ìœ í‹¸ í´ë˜ìŠ¤
â””â”€â”€ init.py

---

## 3. auth/ - JWT í† í° ê²€ì¦ ë° íŒŒì‹± (ì™¸ë¶€ ì¸ì¦ ì„œë²„ ì—°ë™)
```
auth/
â”œâ”€â”€ init.py
â”œâ”€â”€ middleware/ # í† í° ê²€ì¦ ë¯¸ë“¤ì›¨ì–´
â”‚ â”œâ”€â”€ init.py
â”‚ â””â”€â”€ jwt_middleware.py # JWT í† í° ê²€ì¦ ë° ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ
â”œâ”€â”€ exception/ # ì¸ì¦ ê´€ë ¨ ì˜ˆì™¸
â”‚ â”œâ”€â”€ init.py
â”‚ â””â”€â”€ invalid_token_exception.py
â”œâ”€â”€ service/
â”‚ â”œâ”€â”€ init.py
â”‚ â””â”€â”€ jwt_parser_service.py # JWT í† í° íŒŒì‹± ì„œë¹„ìŠ¤
â””â”€â”€ model/
â”œâ”€â”€ init.py
â””â”€â”€ user_principal.py # íŒŒì‹±ëœ ì‚¬ìš©ì ì •ë³´ ëª¨ë¸
```

---

## 4. user/ - íšŒì› ë„ë©”ì¸
```
user/
â”œâ”€â”€ init.py
â”œâ”€â”€ routes.py # ì‚¬ìš©ì ë¼ìš°íŠ¸
â”œâ”€â”€ schemas/ # ë°ì´í„° ê²€ì¦ ìŠ¤í‚¤ë§ˆ
â”‚ â””â”€â”€ init.py
â”œâ”€â”€ model/ # ë°ì´í„° ëª¨ë¸ (SQLAlchemy)
â”‚ â””â”€â”€ init.py
â”œâ”€â”€ exception/ # ì‚¬ìš©ì ë„ë©”ì¸ ê´€ë ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸
â”‚ â”œâ”€â”€ init.py
â”‚ â”œâ”€â”€ duplicated_email_exception.py
â”‚ â””â”€â”€ user_not_found_exception.py
â”œâ”€â”€ repository/ # ë°ì´í„° ì•¡ì„¸ìŠ¤ ë ˆì´ì–´
â”‚ â””â”€â”€ init.py
â””â”€â”€ service/ # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â””â”€â”€ init.py
```

---

## 5. app/cat_eye/ - ê³ ì–‘ì´ ëˆˆ ì§„ë‹¨ ë„ë©”ì¸
```
cat_eye/
â”œâ”€â”€ init.py
â”œâ”€â”€ routes.py # ì§„ë‹¨ API ì—”ë“œí¬ì¸íŠ¸
â”œâ”€â”€ schemas/ # ë°ì´í„° ê²€ì¦ ìŠ¤í‚¤ë§ˆ
â”‚ â”œâ”€â”€ init.py
â”‚ â”œâ”€â”€ request_schema.py # ì´ë¯¸ì§€ ì—…ë¡œë“œ ìš”ì²­ ìŠ¤í‚¤ë§ˆ
â”‚ â””â”€â”€ response_schema.py # ì§„ë‹¨ ê²°ê³¼ ì‘ë‹µ ìŠ¤í‚¤ë§ˆ
â”œâ”€â”€ model/ # ë°ì´í„° ëª¨ë¸
â”‚ â”œâ”€â”€ init.py
â”‚ â””â”€â”€ diagnosis_result.py # ì§„ë‹¨ ê²°ê³¼ ëª¨ë¸
â”œâ”€â”€ exception/ # ë„ë©”ì¸ ì˜ˆì™¸
â”‚ â”œâ”€â”€ init.py
â”‚ â”œâ”€â”€ image_quality_exception.py
â”‚ â””â”€â”€ diagnosis_exception.py
â”œâ”€â”€ repository/ # ë°ì´í„° ì•¡ì„¸ìŠ¤
â”‚ â”œâ”€â”€ init.py
â”‚ â””â”€â”€ diagnosis_repository.py # ì§„ë‹¨ ê²°ê³¼ ì €ì¥/ì¡°íšŒ
â””â”€â”€ service/ # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”œâ”€â”€ init.py
â”œâ”€â”€ image_service.py # ì´ë¯¸ì§€ ì²˜ë¦¬ ì„œë¹„ìŠ¤
â”œâ”€â”€ quality_service.py # í’ˆì§ˆ ê²€ì‚¬ ì„œë¹„ìŠ¤
â””â”€â”€ diagnosis_service.py # ì§ˆë³‘ ì§„ë‹¨ ì„œë¹„ìŠ¤
```

---

## 6. app/models/ - AI ëª¨ë¸ ê´€ë¦¬
```
models/
â”œâ”€â”€ init.py
â”œâ”€â”€ loader/ # ëª¨ë¸ ë¡œë“œ ìœ í‹¸ë¦¬í‹°
â”‚ â”œâ”€â”€ init.py
â”‚ â””â”€â”€ model_loader.py
â”œâ”€â”€ cat_eye/ # ê³ ì–‘ì´ ëˆˆ ê´€ë ¨ AI ëª¨ë¸
â”œâ”€â”€ preprocessing/ # ë°ì´í„° ì „ì²˜ë¦¬
â”‚ â”œâ”€â”€ init.py
â”‚ â””â”€â”€ image_preprocessor.py
â”œâ”€â”€ postprocessing/ # ê²°ê³¼ í›„ì²˜ë¦¬
â”‚ â”œâ”€â”€ init.py
â”‚ â””â”€â”€ result_formatter.py
â””â”€â”€ cache/ # ëª¨ë¸ ìºì‹±
â””â”€â”€ init.py
```
---

## 7. ë„ë©”ì¸ ì¶”ê°€ ì‹œ í™•ì¥ ê·œì¹™
> **ì›ì¹™**
> - routes, service, model, repository, schemas, exception ê³„ì¸µ êµ¬ì¡° ìœ ì§€
> - routesëŠ” RESTful API ì„¤ê³„ ì›ì¹™ ì¤€ìˆ˜ (@app.route ë°ì½”ë ˆì´í„° í™œìš©)
> - serviceëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ ë‹´ë‹¹
> - repositoryëŠ” SQLAlchemyë¥¼ í™œìš©í•œ ë°ì´í„° ì•¡ì„¸ìŠ¤ ë‹´ë‹¹
> - exceptionì€ `BusinessException`ì„ ìƒì†í•˜ê³  ë„ë©”ì¸ë³„ë¡œ ì •ì˜
> - schemasëŠ” `Request`, `Response` ê²€ì¦ ë‹´ë‹¹ (Marshmallow ë˜ëŠ” Pydantic)

---

## 8. íŒŒì¼ ë„¤ì´ë° ê·œì¹™

| ê³„ì¸µ         | ì ‘ë¯¸ì‚¬ ì˜ˆì‹œ              |
|--------------|--------------------------|
| Routes       | `routes.py`              |
| Service      | `*_service.py`           |
| Schemas      | `*_schema.py`            |
| Model        | ì‹¤ì œ ë„ë©”ì¸ëª…            |
| Repository   | `*_repository.py`        |
| Exception    | `*_exception.py`         |
| Middleware   | `*_middleware.py`        |

---

## 9. ê³µí†µ íŒŒì¼ ê·œì¹™

- ëª¨ë“  ê³µí†µ ì˜ˆì™¸ëŠ” `global/exception`ì— ìœ„ì¹˜í•˜ê³  `BusinessException`ì„ ìƒì†
- ë„ë©”ì¸ë³„ ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ëŠ” ê° ë„ë©”ì¸ì˜ `exception/` í´ë”ì— ìœ„ì¹˜
- `ErrorCode`ëŠ” HTTP ìƒíƒœ ì½”ë“œ, ì½”ë“œ ë¬¸ìì—´, ë©”ì‹œì§€ë¥¼ í¬í•¨í•¨
- ì‘ë‹µì€ `ApiResponse` í˜•ì‹ìœ¼ë¡œ í†µì¼ (`global/response`)
- ì¸ì¦ ì‚¬ìš©ì ì •ë³´ëŠ” `UserPrincipal`ë¡œ í†µí•©
- ì„¤ì •ì€ `app/config.py` ë° `.env` íŒŒì¼ë¡œ ê´€ë¦¬
- Python ëª¨ë“ˆì€ í•­ìƒ `__init__.py` í¬í•¨

---

## 10. í…ŒìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°
`tests/` ê¸°ì¤€

- ë„ë©”ì¸ ê¸°ì¤€ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì„±
```
tests/
â”œâ”€â”€ conftest.py # pytest ê³µí†µ fixture
â”œâ”€â”€ cat_eye/
â”‚ â”œâ”€â”€ test_routes.py
â”‚ â”œâ”€â”€ test_services.py
â”‚ â””â”€â”€ test_models.py
â”œâ”€â”€ models/
â”‚ â”œâ”€â”€ test_quality_model.py
â”‚ â””â”€â”€ test_disease_model.py
```
> pytest ì‚¬ìš©, test_ ì ‘ë‘ì‚¬ ì‚¬ìš©

---

## 11. ê¸°íƒ€ í™•ì¥ ê°€ì´ë“œ

- ê´€ë¦¬ì ì „ìš© APIëŠ” `admin/` ë„ë©”ì¸ìœ¼ë¡œ ë¶„ë¦¬
- ë¹„ë™ê¸° ì‘ì—…ì€ `tasks/` ë””ë ‰í† ë¦¬ë¡œ êµ¬ì„± (Celery ì‚¬ìš©)
- ì™¸ë¶€ ì—°ë™ APIëŠ” `integrations/` ë””ë ‰í† ë¦¬ ì‚¬ìš©
```
integrations/
â”œâ”€â”€ init.py
â”œâ”€â”€ cloud/
â”‚ â”œâ”€â”€ init.py
â”‚ â””â”€â”€ s3_client.py # ì´ë¯¸ì§€ ì €ì¥ì†Œ
â”œâ”€â”€ notification/
â”‚ â”œâ”€â”€ init.py
â”‚ â””â”€â”€ email_service.py
â””â”€â”€ payment/
â””â”€â”€ init.py
```

- ë°ì´í„° ì €ì¥/ìºì‹œëŠ” `storage/` ë””ë ‰í† ë¦¬ ì‚¬ìš©
```
storage/
â”œâ”€â”€ init.py
â”œâ”€â”€ file_storage.py # ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥
â””â”€â”€ cache_service.py # ê²°ê³¼ ìºì‹±
```

